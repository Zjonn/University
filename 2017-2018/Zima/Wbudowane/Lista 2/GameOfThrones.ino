/*
* Lista 2.cpp
*
* Created: 28.10.2017 00:57:41
* Author : Zjonn
*/

#include <avr/io.h>
#define int8 uint8_t
#define SPEAKER 0b01000000


const uint16_t gameOfThrones[] PROGMEM = {
	0x4F04, 0x7604, 0x6302, 0x5802,
	0x4F04, 0x7604, 0x6302, 0x5802,
	0x4F04, 0x7604, 0x6302, 0x5802,
	0x4F04, 0x7604, 0x5D02, 0x5802,
	0x4F04, 0x7604, 0x5D02, 0x5802,
	0x4F04, 0x7604, 0x5D02, 0x5802,
	0x4F04, 0x7604, 0x5D02, 0x5802,
	0x4F04, 0x7604, 0x5D02, 0x5802,
	0x4F0C, 0x760C, 0x6302, 0x5802,
	0x4F08, 0x7608, 0x6302, 0x5802,
	0x6904, 0x8E04, 0x7E02, 0x7602,
	0x6904, 0x8E04, 0x7E02, 0x7602,
	0x6904, 0x8E04, 0x7E02, 0x7602,
	0x6904, 0x8E06, 0x7E06, 0x580C,
	0x7E0C, 0x6302, 0x6902, 0x5808,
	0x7E08, 0x6302, 0x6902, 0x7604,
	0xBD04, 0x8E02, 0x7E02, 0x7604,
	0xBD04, 0x8E02, 0x7E02, 0x7604,
	0xBD04, 0x8E02, 0x7E02, 0x7604,
	0xBD06, 0x8E06, 0x4F0C, 0x760C,
	0x6302, 0x5802, 0x4F08, 0x7608,
	0x6302, 0x5802, 0x6904, 0x9F04,
	0x7E02, 0x7602, 0x6904, 0x9F04,
	0x7E02, 0x7602, 0x6904, 0x9F04,
	0x7E02, 0x7602, 0x6904, 0x9F06,
	0x7E06, 0x580C, 0x7E0C, 0x6302,
	0x6902, 0x5808, 0x7E08, 0x6302,
	0x6902, 0x7604, 0x9F04, 0x8E02,
	0x7E02, 0x7604, 0x9F04, 0x8E02,
	0x7E02, 0x7604, 0x9F04, 0x8E02,
	0x7E02, 0x7604, 0x9F06, 0x7606,
	0
};

void initTimer() {
	TCCR0A |= (1 << WGM01); // CCT
	TCCR0A |= (1 << COM0A0);
	TCCR0B |= (1 << CS02); //256
}

void playNote(int8 waveLength, int8 duration) {
	OCR0A = waveLength;
	DDRD ^= SPEAKER;
	for(; duration>0; duration--)
	_delay_ms(89);
	DDRD ^= SPEAKER;

}

int main(void) {
	/* Replace with your application code */
	initTimer();
	while (1) {
		uint16_t val;
		for(int i = 0; (val = pgm_read_word(&(gameOfThrones[i])))!=0 ; i++)
		playNote((val & 0xFF00) >> 8, val & 0xFF);
		_delay_ms(1000);
	}
}